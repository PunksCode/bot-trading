<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Bot Trading</title>
  <style>
    body { font-family: system-ui, Arial; padding: 20px; max-width: 980px; margin: auto; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start; }
    .card { border:1px solid #ddd; border-radius:12px; padding:16px; box-shadow: 0 1px 4px rgba(0,0,0,.05); }
    button { padding:10px 14px; border-radius:10px; border:1px solid #333; cursor:pointer; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border:1px solid #ccc; padding:8px; text-align:left; }
    .ok { color: #0a7; } .bad { color: #c33; }
  </style>
  <script>
    async function refreshPrice(){
      try{
        const r = await fetch("/price/");
        const j = await r.json();
        if(j.ok){
          document.getElementById("price").innerText = j.price.toFixed(4);
        }
      }catch(e){}
    }
    setInterval(refreshPrice, 10);
    window.addEventListener("load", refreshPrice);
  </script>
</head>
<body>

  <h1>Bot Trading</h1>

  <div class="row">
    <div class="card">
      <h3>Estado del Bot: <span class="{{ running|yesno:'ok,bad' }}">{{ running|yesno:'üü¢ Activo,üî¥ Detenido' }}</span></h3>
      <form method="post" action="{% url 'toggle' %}">{% csrf_token %}
        <button type="submit">{% if running %}Detener{% else %}Iniciar{% endif %}</button>
      </form>

      <h3 style="margin-top:18px;">Conexi√≥n Binance: 
        {% if connected %}<span class="ok">OK</span>{% else %}<span class="bad">Sin conexi√≥n</span>{% endif %}
      </h3>
      <p>S√≠mbolo: <strong>{{ symbol }}</strong></p>
      <p>Precio: <strong id="price">{% if price %}{{ price }}{% else %}-{% endif %}</strong></p>

      <div style="margin-top:12px;">
        <form method="post" action="{% url 'buy' %}" style="display:inline">{% csrf_token %}
          <button type="submit">BUY {{ qty }}</button>
        </form>
        <form method="post" action="{% url 'sell' %}" style="display:inline; margin-left:8px">{% csrf_token %}
          <button type="submit">SELL {{ qty }}</button>
        </form>
      </div>
    </div>

    <div class="card">
      <h3>Estrategia</h3>
      <p>{{ cfg.name }} (fast={{ cfg.param_fast }}, slow={{ cfg.param_slow }}) ‚Äî 
        {% if cfg.is_enabled %}‚úÖ Activada{% else %}‚ùå Inactiva{% endif %}</p>
      <p><a href="/admin/ui/strategyconfig/">Editar en Admin</a></p>
    </div>
  </div>

  <div class="card" style="margin-top:16px;">
    <h3>√öltimos Trades</h3>
    <table>
      <tr><th>Fecha</th><th>Side</th><th>Precio</th><th>Qty</th><th>Status</th><th>Error</th></tr>
      {% for t in trades %}
      <tr>
        <td>{{ t.created_at }}</td>
        <td>{{ t.side }}</td>
        <td>{{ t.price }}</td>
        <td>{{ t.qty }}</td>
        <td>{{ t.status }}</td>
        <td>{{ t.error|default:"" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="6">Sin operaciones a√∫n</td></tr>
      {% endfor %}
    </table>
  </div>

</body>
</html>
